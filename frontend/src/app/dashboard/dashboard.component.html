<div class="dashboard-container">
  <nav class="sidebar">
    <h3>Cargar Imagen</h3>
    <input type="file" (change)="onFileSelected($event)" accept="image/*" />
    <p *ngIf="fileName">Archivo seleccionado: {{ fileName }}</p>

    <button (click)="onPredict()" [disabled]="!imageSrc" class="btn-predict" type="button">
      Predicci√≥n
    </button>

    <button (click)="onReset()" class="btn-reset" type="button">
      Reiniciar
    </button>

    <button (click)="logout()" class="btn-logout" type="button">
      Cerrar sesi√≥n
    </button>
  </nav>

  <main class="content">
    <h1>Reconocimiento Autom√°tico de Productos</h1>
    <p class="descripcion">
      Por favor, selecciona una imagen del producto desde el panel lateral izquierdo y haz clic en
      <strong>‚ÄúPredicci√≥n‚Äù</strong> para obtener autom√°ticamente sus detalles.
    </p>
    <p *ngIf="imageSrc && !resultado && !cargando">‚úÖ Carga exitosa, esperando a predecir...</p>

    <div class="image-preview-container">
      <img *ngIf="imageSrc" [src]="imageSrc" alt="" class="img-preview" />
    </div>

    <!-- Resultado: M√∫ltiples productos o uno solo -->
    <div class="resultado" *ngIf="resultado && !cargando">
      <h2>üì¶ Detalles de Productos Detectados</h2>

      <!-- Mostrar cantidad total -->
      <p class="count" *ngIf="resultado.productos?.length">
        üîé Se detectaron {{ resultado.productos.length }} productos.
      </p>

      <!-- Si es una lista de productos -->
      <ng-container *ngIf="resultado.productos?.length > 0; else productoUnico">
        <div class="productos-grid">
          <div *ngFor="let producto of resultado.productos" class="ficha-producto">
            <p><strong>ID:</strong> {{ producto.ID }}</p>
            <p><strong>Nombre:</strong> {{ producto.Nombre }}</p>
            <p><strong>Descripci√≥n:</strong> {{ producto.Descripcion }}</p>
            <p><strong>Categor√≠a:</strong> {{ producto.Categoria }}</p>
            <p><strong>Costo:</strong> ${{ producto.Costo }}</p>
            <p><strong>Stock:</strong> {{ producto.Stock }} unidades</p>
            <p><strong>Fecha de Caducidad:</strong> {{ producto.Fecha_Caducidad }}</p>
          </div>
        </div>
      </ng-container>

      <!-- Si es un solo producto (formato anterior) -->
      <ng-template #productoUnico>
        <div class="ficha-producto">
          <p><strong>ID:</strong> {{ resultado.ID }}</p>
          <p><strong>Nombre:</strong> {{ resultado.Nombre }}</p>
          <p><strong>Descripci√≥n:</strong> {{ resultado.Descripcion }}</p>
          <p><strong>Categor√≠a:</strong> {{ resultado.Categoria }}</p>
          <p><strong>Costo:</strong> ${{ resultado.Costo }}</p>
          <p><strong>Stock:</strong> {{ resultado.Stock }} unidades</p>
          <p><strong>Fecha de Caducidad:</strong> {{ resultado.Fecha_Caducidad }}</p>
        </div>
      </ng-template>
    </div>

    <!-- üß† Asistente Inteligente -->
    <hr />
    <!-- Chat inteligente -->
    <section class="chat-container">
      <h2>üß† Asistente Inteligente</h2>

      <div class="chat-box">
        <div *ngFor="let mensaje of historialChat" [ngClass]="mensaje.tipo">
          <strong *ngIf="mensaje.tipo === 'usuario'">T√∫:</strong>
          <strong *ngIf="mensaje.tipo === 'asistente'">Asistente:</strong>
          <p>{{ mensaje.texto }}</p>
        </div>
      </div>

      <div class="chat-input">
        <input type="text" placeholder="Escribe tu pregunta..." [(ngModel)]="mensajeUsuario"
          (keydown.enter)="enviarMensaje()" />
        <button (click)="enviarMensaje()">Enviar</button>
        <button (click)="limpiarMensaje()" class="btn-limpiar">Limpiar</button>
      </div>
    </section>

  </main>
</div>